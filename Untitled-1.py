def приветствие():
    print("Добро пожаловать в игру библиотечный черьв")
    print("Вы попали в библеотеку, и вы должны пройти 3 уровня чтобы выйти и выиграть.")
    name = input("Введите ваше имя: ")
    print(f"Привет, {name} твоя задача - пройти все три уровня, делая правильные выборы.")
    return name

def уровень_1(inv, key):
    print(" Уровень 1: Тёмные полки ")
    print("Перед вами два пути: левый и правый.")
    vib = input("Куда пойти? (лево/право): ")

    if vib == "лево":
        print("Вы пошли в левую полку и нашли сундук.")
        if "ключ" not in inv:
            print("В сундуке есть ключ.")
            получить = input("Взять ключ? (да/нет): ")
            if получить == "да":
                inv.append("ключ")
                key.add("замок_1")
                print("Вы взяли ключ.")
            else:
                print("Вы решили не брать ключ.")
        else:
            print("Вы уже взяли ключ из этого сундука.")
    elif vib == "право":
        print("Вы пошли вправо и наткнулись на книжку с замком.")
        if "ключ" in inv:
            print("У вас есть ключ. Это дверь с замком.")
            open = input("Открыть дверь? (да/нет): ")
            if open == "да":
                print("Дверь открылась. Вы прошли первый уровень.")
                return True
            else:
                print("Вы не открываете книжку и возвращаетесь.")
                return False
        else:
            print("Книга заперта, и у вас нет ключа.")
            return False
    else:
        print("Неверный выбор, попробуйте снова.")
        return уровень_1(inv, key)

def уровень_2(inv, key):
    print(" Уровень 2: Лабиринт по страницам ")
    lab = {
        'A': ['B', 'C'],
        'B': ['A', 'D'],
        'C': ['A', 'D'],
        'D': ['B', 'C', 'E'],
        'E': []
    }
    now = 'A'
    was = set()

    while True:
        print(f"Вы в точке {now}. Доступные пути: {lab[now]}")
        vib = input("Куда пойдёте? (введите название точки или 'выход'): ")

        if vib == 'ВЫХОД':
            print("Вы решили остановиться и вернуться назад.")
            return False

        if vib in lab[now]:
            now = vib
            was.add(vib)
            if now == 'E':
                print("Вы нашли выход из лабиринта!")
                return True
        else:
            print("Неверный путь или нет выхода отсюда.")

def уровень_3(inv, key):
    print(" Уровень 3: Последняя книга ")
    secret = (4, 7, 9)
    prav = set(secret)

    print("Перед вами святая книга с загадочной панелью которая может вернуть вас домой. Для этого требуется ввести трёхзначный код.")
    popitki = 3

    while popitki > 0:
        vvod = input("Введите три числа через пробел: ")
        try:
            numb = tuple(map(int, vvod.split()))
            if len(numb) != 3:
                print("Пожалуйста, введите ровно три числа.")
                continue
        except:
            print("Ошибка ввода. Попробуйте снова.")
            continue

        uniq = set(numb)
        if uniq == prav:
            print("Код правильный. Книга отправила вас домой.")
            return True
        else:
            popitki -=1
            print(f"Неверный код. Осталось попыток: {popitki}")

    print("Вы использовали все попытки. Черьв который шел за вами вас кровожадно убил.")
    return False

def основная_игра():
    name = приветствие()
    inv = []
    key = set()


    успех_1 = False
    while not успех_1:
        успех_1 = уровень_1(inv, key)


    успех_2 = False
    while not успех_2:
        успех_2 = уровень_2(inv, key)


    успех_3 = уровень_3(inv, key)

    if успех_1 and успех_2 and успех_3:
        print(f"Поздравляем, {name}. Вы прошли все уровни и вышли из замка.")
    else:
        print(f"К сожалению, {name}, вы не смогли пройти все уровни. И были зарезаны и съедены на обед книжным червем.")

